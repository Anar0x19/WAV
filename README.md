# WAV

программа на Си которая принимает на вход WAV-файл – стерео, 16 бит на канал, длинной примерно от 20 секунд до 6 минут (то есть размер менее 256 Мб).  она находит в нём наибольший «кусок» звука, который повторён в этом же самом файле – и вырезает его, вернув файл меньшей длины. Но в стереозаписи, оба канала почти никогда не бывают одновременно равны нулю, разве что на концах композиции. Даже ловя в какую-нибудь околонулевую зону, у меня не получалось разбить рандомную музыку на юзабельные промежутки – чтобы отталкиваться от них, и резать по ним (ведь самый безопасный способ монтажа – склеивать по нулевым семплам, чтобы не было щелчков даже когда отрезано не там).
Тогда я забил на разбиение, и шёл просто циклом по всем семплам

полный перебор всех семплов – это «N^3», жутко медленный способ! Мой изначальный алгоритм был такой:
1) Идём циклом от первого семпла до середины файла (подразумевая, что «вступление» не может быть длиннее половины файла, и где-то уже должен был встретиться повтор), этот цикл пытается отрезать «вступление» и начти точку первого повтора (начало тела мелодии);
2) В каждой итерации: от точки, где мы сейчас хотим начать, отмеряем отрезок для прохода вторым циклом (ищущим второй повтор, начало ещё одного тела). Он идёт от 1/4 оставшейся длины, до 1/2 оставшейся длины – ведь дальше половины второй повтор не может начинаться, ибо не успеет закончиться; до четверти остатка – он тоже не может начинаться, ведь иначе успел бы повториться уже четыре раза, а не три (если предположить, что «завершение» не может по длительности превосходить один повтор);
3) В каждой итерации второго цикла: идём третьим циклом по семплам, от +[0] до +[разницы между началами второго и первого циклов] – в нём сравниваем семплы от индекса первого и индекса второго циклов на _эту_ величину (фактическая проверка, стоят ли индексы двух циклов на двух повторах, у которых конец первого стыкуется с началом второго). За последний семпл мы не выйдем, потому что второй цикл ведь закончится на половине оставшегося пространства (и в последней итерации третьего цикла – мы как раз и затронем последний семпл).
4) Каждое сравнение считает разницу между двумя семплами так: по каждому из двух каналов вычисляется прямая разность, возводится в квадрат, а потом они суммируются между собой и аккумулируются в третьем цикле; второй же цикл запоминает «лучший» результат с наименьшей суммой, а первый – каким-нибудь образом использует результаты второго цикла, ориентируясь ещё и на длину найденного повтора.
